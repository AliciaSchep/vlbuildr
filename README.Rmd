---
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

![lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)

# vlbuildr

The goal of vlbuildr is to provide an R api for building up vega-lite specs. This package is in very early stages at the moment... very incomplete!


## Examples

These are some examples showing current capabilities:

```{r example}
library(vlbuildr)
library(vegawidget)
vl_chart() %>%
   vl_add_data(values = mtcars) %>%
   vl_mark_point() %>%
   vl_encode_x(field = "wt", type = "quantitative") %>%
   vl_encode_y(field = "mpg", type = "quantitative") %>%
   vw_write_png("README-example-1.png")

knitr::include_graphics("README-example-1.png")
```

```{r example2}
vl_chart() %>%
    vl_add_data(url = "https://vega.github.io/vega-editor/app/data/stocks.csv") %>%
    vl_filter("datum.symbol==='GOOG'") %>%
    vl_encode_x(field = "date", type = "temporal") %>%
    vl_encode_y(field = "price", type = "quantitative") %>%
    vl_mark_line() %>%
    vw_write_png("README-example2-1.png")

knitr::include_graphics("README-example2-1.png")
```

```{r}
vl_chart() %>%
  vl_add_data(url = "https://vega.github.io/vega-editor/app/data/movies.json") %>%
  vl_encode_x(field = "IMDB_Rating", type = "quantitative") %>%
  vl_encode_y(type = "quantitative") %>%
  vl_bin_x(maxbins=10) %>%
  vl_aggregate_y("count") %>%
  vl_mark_bar()
```


```{r}
vl_chart() %>%
  vl_add_data(url = "https://vega.github.io/vega-editor/app/data/population.json") %>%
  vl_calculate(calculate = "datum.sex == 2 ? 'Female' : 'Male'", 
               as = "gender") %>%
  vl_filter("datum.year == 2000") %>%
  vl_encode_x(field = "age", 
              type = "ordinal") %>%
  vl_scale_x(rangeStep = 17) %>%
  vl_encode_y(field = "people", type = "quantitative") %>%
  vl_stack_y("normalize") %>%
  vl_aggregate_y("sum") %>%
  vl_axis_y(title = "population") %>%
  vl_encode_color(field = "gender", type = "nominal") %>%
  vl_mark_bar() 
```



```{r}
vl_chart() %>%
  vl_add_data(url = "https://vega.github.io/vega-editor/app/data/population.json") %>%
  vl_filter("datum.year == 2000") %>%
  vl_encode_y(field = "age", 
              type = "ordinal", 
              scale = list(rangeStep = 17)) %>%
  vl_encode_x(field = "people", 
              type = "quantitative", 
              aggregate = "sum",
              axis = list(title = "population"), 
              stack = "normalize") %>%
  vl_mark_bar() %>%
  vl_sort_y_by_encoding(encoding = "x")

```

```{r}
vl_chart() %>%
  vl_add_data(url = "https://vega.github.io/vega-editor/app/data/cars.json") %>%
  vl_mark_tick() %>%
  vl_encode_x(field = "Horsepower", type = "quantitative") %>%
  vl_sort_x("descending")
```

